<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Test GitHub Authentication</title>
    <style>
        body {
            font-family: monospace;
            padding: 20px;
            max-width: 800px;
            margin: 0 auto;
        }
        .result {
            background: #f0f0f0;
            padding: 10px;
            margin: 10px 0;
            border: 1px solid #ccc;
            white-space: pre-wrap;
        }
        button {
            padding: 10px 20px;
            margin: 5px;
            cursor: pointer;
        }
    </style>
</head>
<body>
    <h1>GitHub Authentication Test</h1>

    <div>
        <button onclick="checkToken()">Check Token</button>
        <button onclick="testPublicRepo()">Test Public Repo</button>
        <button onclick="testPrivateRepo()">Test Private Repo (thomasrribeiro/my-flashcards-physics)</button>
        <button onclick="getUserInfo()">Get User Info</button>
    </div>

    <div id="results"></div>

    <script type="module">
        import { getRepository, getAuthenticatedUser, getUserRepositories } from './src/github-client.js';

        window.checkToken = function() {
            const token = localStorage.getItem('github_token');
            const user = localStorage.getItem('github_user');

            const results = document.getElementById('results');
            results.innerHTML = `<div class="result">Token exists: ${!!token}
User: ${user ? JSON.parse(user).username : 'Not logged in'}
Token (first 10 chars): ${token ? token.substring(0, 10) + '...' : 'None'}</div>` + results.innerHTML;
        }

        window.testPublicRepo = async function() {
            const results = document.getElementById('results');
            try {
                const repo = await getRepository('facebook', 'react');
                results.innerHTML = `<div class="result">✅ Public repo test passed: ${repo.full_name}</div>` + results.innerHTML;
            } catch (error) {
                results.innerHTML = `<div class="result">❌ Public repo test failed: ${error.message}</div>` + results.innerHTML;
            }
        }

        window.testPrivateRepo = async function() {
            const results = document.getElementById('results');
            try {
                const repo = await getRepository('thomasrribeiro', 'my-flashcards-physics');
                results.innerHTML = `<div class="result">✅ Private repo test passed: ${repo.full_name}
Private: ${repo.private}
Description: ${repo.description || 'None'}</div>` + results.innerHTML;
            } catch (error) {
                results.innerHTML = `<div class="result">❌ Private repo test failed: ${error.message}</div>` + results.innerHTML;
            }
        }

        window.getUserInfo = async function() {
            const results = document.getElementById('results');
            try {
                const user = await getAuthenticatedUser();
                const repos = await getUserRepositories();
                results.innerHTML = `<div class="result">✅ User: ${user.login}
Name: ${user.name}
Public repos: ${user.public_repos}
Private repos: ${user.total_private_repos || 'N/A'}
Total fetched repos: ${repos.length}</div>` + results.innerHTML;
            } catch (error) {
                results.innerHTML = `<div class="result">❌ User info failed: ${error.message}</div>` + results.innerHTML;
            }
        }
    </script>
</body>
</html>